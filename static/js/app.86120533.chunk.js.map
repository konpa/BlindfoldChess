{"version":3,"sources":["src/services/LichessCtrl.ts","src/context/AuthProvider.tsx","src/screens/LoginScreen.tsx","src/screens/HomeScreen.tsx","src/routes/Router.tsx","App.tsx"],"names":["lichessHost","clientUrl","url","URL","document","location","href","search","LichessCtrl","oauth","OAuth2AuthCodePKCE","authorizationUrl","tokenUrl","clientId","scopes","redirectUrl","onAccessTokenExpiry","refreshAccessToken","onInvalidGrant","a","async","this","fetchAuthorizationCode","AsyncStorage","getItem","authDataSerialized","JSON","parse","isReturningFromAuthServer","getAccessToken","accessContext","token","value","fetch","decorateFetchHTTPClient","window","getUsername","user","name","setItem","stringify","res","json","username","method","headers","Authorization","undefined","error","removeItem","AuthContext","createContext","AuthProvider","children","useState","setUser","isLoading","setIsLoading","setError","AuthContextValue","useMemo","login","logout","then","finally","Provider","propTypes","PropTypes","element","isRequired","LoginScreen","useContext","Box","alignItems","justifyContent","flex","p","_dark","bg","Heading","size","style","textTransform","color","Text","mb","Link","ml","Button","onPress","mt","w","maxW","colorScheme","fontSize","position","bottom","left","right","py","Center","Stack","space","Alert","status","variant","VStack","flexShrink","HStack","Icon","toString","IconButton","icon","Close","HomeScreen","StatusBar","safeAreaTop","px","as","MaterialIcons","fontWeight","h","createNativeStackNavigator","Router","useEffect","init","response","catch","Spinner","accessibilityLabel","NavigationContainer","Navigator","Screen","component","options","headerShown","customTheme","extendTheme","config","useSystemColorMode","initialColorMode","App","NativeBaseProvider","theme"],"mappings":"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","file":"static/js/app.86120533.chunk.js","sourcesContent":["import { AccessContext, HttpClient, OAuth2AuthCodePKCE } from '@bity/oauth2-auth-code-pkce';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\nexport const lichessHost = 'https://lichess.org';\nexport const clientId = 'blindfoldchess.dev';\nexport const clientUrl = (() => {\n  const url = new URL(document.location.href);\n  url.search = '';\n  return url.href;\n})();\n\nexport class LichessCtrl {\n  oauth = new OAuth2AuthCodePKCE({\n    authorizationUrl: `${lichessHost}/oauth`,\n    tokenUrl: `${lichessHost}/api/token`,\n    clientId,\n    scopes: ['challenge:write', 'bot:play', 'board:play'],\n    redirectUrl: clientUrl,\n    onAccessTokenExpiry: (refreshAccessToken) => refreshAccessToken(),\n    onInvalidGrant: () => {},\n  });\n\n  error?: any;\n\n  accessContext?: AccessContext;\n\n  token?: string;\n\n  name?: string;\n\n  async login() {\n    await this.oauth.fetchAuthorizationCode();\n  }\n\n  async init() {\n    const authDataSerialized = await AsyncStorage.getItem('@AuthData');\n\n    if (authDataSerialized) {\n      return JSON.parse(authDataSerialized);\n    }\n\n    const hasAuthCode = await this.oauth.isReturningFromAuthServer();\n\n    if (hasAuthCode) {\n      this.accessContext = await this.oauth.getAccessToken();\n      this.token = this.accessContext?.token?.value;\n\n      const fetch = this.oauth.decorateFetchHTTPClient(window.fetch);\n      await this.getUsername(fetch);\n\n      const user = {\n        token: this.token,\n        name: this.name,\n      };\n\n      await AsyncStorage.setItem('@AuthData', JSON.stringify(user));\n\n      return user;\n    }\n\n    return null;\n  }\n\n  async getUsername(fetch: HttpClient) {\n    const res = await fetch(`${lichessHost}/api/account`);\n    this.name = (await res.json()).username;\n  }\n\n  async logout() {\n    let user = null;\n    const authDataSerialized = await AsyncStorage.getItem('@AuthData');\n\n    if (authDataSerialized) {\n      user = JSON.parse(authDataSerialized);\n    }\n\n    const { token } = user;\n\n    await fetch(`${lichessHost}/api/token`, {\n      method: 'DELETE',\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n    });\n\n    this.token = undefined;\n    this.accessContext = undefined;\n    this.error = undefined;\n\n    await AsyncStorage.removeItem('@AuthData');\n  }\n}\n","import React, { createContext, useState, useMemo } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { LichessCtrl } from '../services/LichessCtrl';\n\ntype AuthContextData = {\n  user: any,\n  setUser: any,\n  isLoading: boolean,\n  error: any,\n  setError: any,\n  login(): void,\n  logout(): void,\n};\n\nexport const AuthContext = createContext<AuthContextData>({} as AuthContextData);\n\nexport function AuthProvider({ children }:{ children:any }) {\n  const [user, setUser] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(null);\n\n  const AuthContextValue = useMemo(() => ({\n    user,\n    setUser,\n    error,\n    setError,\n    isLoading,\n    login: () => {\n      setIsLoading(true);\n      new LichessCtrl().login();\n    },\n    logout: () => {\n      setIsLoading(true);\n      new LichessCtrl().logout()\n        .then(() => {\n          setUser(null);\n        })\n        .finally(() => {\n          setIsLoading(false);\n        });\n    },\n  }), [user, error, isLoading]);\n\n  return (\n    <AuthContext.Provider\n      value={AuthContextValue}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nAuthProvider.propTypes = {\n  children: PropTypes.element.isRequired,\n};\n","import React, { useContext } from 'react';\nimport {\n  Box, Button, Center, Stack, Alert, VStack, HStack, Text, IconButton, CloseIcon, Heading, Link,\n} from 'native-base';\n\nimport { AuthContext } from '../context/AuthProvider';\n\nexport default function LoginScreen() {\n  const { login, isLoading, error } = useContext(AuthContext);\n\n  return (\n    <>\n      <Box\n        alignItems=\"center\"\n        justifyContent=\"center\"\n        flex={1}\n        p=\"5\"\n        _dark={{ bg: 'light.800' }}\n      >\n        <Heading size=\"lg\" style={{ textTransform: 'uppercase' }} _dark={{ color: 'light.300' }}>Blindfold Chess</Heading>\n        <Text mb=\"16\" _dark={{ color: 'light.300' }}>\n          Powered by\n          <Link href=\"lichess.org\" ml=\"1\">lichess.org</Link>\n        </Text>\n        <Button\n          onPress={() => login()}\n          mt=\"2\"\n          w=\"100%\"\n          maxW=\"300\"\n          isLoading={isLoading}\n          colorScheme=\"amber\"\n        >\n          SIGN IN\n        </Button>\n        <Text mt=\"2\" fontSize=\"xs\" _dark={{ color: 'light.300' }}>\n          Sign in with your lichess account\n        </Text>\n      </Box>\n      {error && (\n        <Box\n          position=\"absolute\"\n          bottom=\"0\"\n          left=\"0\"\n          right=\"0\"\n          py=\"3\"\n        >\n          <Center>\n            <Stack space={3} w=\"90%\" maxW=\"400\">\n              <Alert w=\"100%\" status=\"error\" variant=\"left-accent\">\n                <VStack space={2} flexShrink={1} w=\"100%\">\n                  <HStack flexShrink={1} space={2} justifyContent=\"space-between\">\n                    <HStack space={2} flexShrink={1}>\n                      <Alert.Icon mt=\"1\" />\n                      <Text fontSize=\"md\" color=\"coolGray.800\">\n                        {error.toString()}\n                      </Text>\n                    </HStack>\n                    <IconButton variant=\"unstyled\" icon={<CloseIcon size=\"3\" color=\"coolGray.600\" />} />\n                  </HStack>\n                </VStack>\n              </Alert>\n            </Stack>\n          </Center>\n        </Box>\n      )}\n    </>\n  );\n}\n","import React, { useContext } from 'react';\nimport {\n  StatusBar, Box, HStack, IconButton, Icon, Text, Center, Stack, Button,\n} from 'native-base';\nimport { MaterialIcons } from '@expo/vector-icons';\n\nimport { AuthContext } from '../context/AuthProvider';\n\nexport default function HomeScreen() {\n  const { logout } = useContext(AuthContext);\n\n  return (\n    <>\n      <StatusBar />\n      <Box safeAreaTop />\n      <HStack\n        px=\"1\"\n        py=\"3\"\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        w=\"100%\"\n        _dark={{ bg: 'light.900' }}\n      >\n        <HStack>\n          <IconButton icon={<Icon size=\"sm\" as={MaterialIcons} name=\"menu\" _dark={{ color: 'light.300' }} />} />\n        </HStack>\n        <HStack>\n          <Text\n            fontSize=\"sm\"\n            fontWeight=\"bold\"\n            textTransform=\"uppercase\"\n            _dark={{ color: 'light.300' }}\n          >\n            Blindfold Chess\n          </Text>\n        </HStack>\n        <HStack>\n          <IconButton\n            onPress={() => logout()}\n            icon={<Icon as={MaterialIcons} name=\"logout\" size=\"sm\" _dark={{ color: 'light.300' }} />}\n          />\n        </HStack>\n      </HStack>\n      <Box\n        w=\"100%\"\n        h=\"100%\"\n        _dark={{ bg: 'light.800' }}\n      />\n      <Box\n        position=\"absolute\"\n        bottom=\"0\"\n        left=\"0\"\n        right=\"0\"\n        py=\"3\"\n      >\n        <Center>\n          <Stack space={3} w=\"90%\" maxW=\"400\">\n            <Button\n              colorScheme=\"amber\"\n            >\n              NEW GAME\n            </Button>\n          </Stack>\n        </Center>\n      </Box>\n    </>\n  );\n}\n","import React, { useContext, useEffect, useState } from 'react';\nimport { NavigationContainer } from '@react-navigation/native';\nimport { createNativeStackNavigator } from '@react-navigation/native-stack';\nimport {\n  Box, HStack, Spinner, Heading,\n} from 'native-base';\n\nimport { AuthContext } from '../context/AuthProvider';\nimport { LichessCtrl } from '../services/LichessCtrl';\nimport LoginScreen from '../screens/LoginScreen';\nimport HomeScreen from '../screens/HomeScreen';\n\nconst Stack = createNativeStackNavigator();\n\nexport default function Router() {\n  const appName = 'Blindfold Chess';\n  const [isLoading, setIsLoading] = useState(true);\n  const {\n    user, setUser, setError,\n  } = useContext(AuthContext);\n\n  useEffect(() => {\n    setIsLoading(true);\n    new LichessCtrl().init()\n      .then((response) => {\n        setUser(response);\n      })\n      .catch((error) => {\n        setError(error);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      });\n  }, [setUser, setError, setIsLoading]);\n\n  if (isLoading) {\n    return (\n      <Box\n        alignItems=\"center\"\n        justifyContent=\"center\"\n        flex={1}\n        _dark={{ bg: 'coolGray.800' }}\n      >\n        <HStack space={2} justifyContent=\"center\">\n          <Spinner accessibilityLabel=\"Loading\" />\n          <Heading color=\"primary.500\" fontSize=\"md\">\n            Loading\n          </Heading>\n        </HStack>\n      </Box>\n    );\n  }\n\n  return (\n    <NavigationContainer>\n      <Stack.Navigator>\n        {user == null ? (\n          // No token found, user isn't signed in\n          <Stack.Screen\n            name={`Sign In - ${appName}`}\n            component={LoginScreen}\n            options={{ headerShown: false }}\n          />\n        ) : (\n          // User is signed in\n          <Stack.Screen\n            name={`Home - ${appName}`}\n            component={HomeScreen}\n            options={{ headerShown: false }}\n          />\n        )}\n      </Stack.Navigator>\n    </NavigationContainer>\n  );\n}\n","import React from 'react';\nimport { NativeBaseProvider, extendTheme } from 'native-base';\n\nimport Router from './src/routes/Router';\nimport { AuthProvider } from './src/context/AuthProvider';\n\nconst config = {\n  useSystemColorMode: true,\n  initialColorMode: 'light',\n};\n\nconst customTheme = extendTheme({ config });\n\nexport default function App() {\n  return (\n    <NativeBaseProvider theme={customTheme}>\n      <AuthProvider>\n        <Router />\n      </AuthProvider>\n    </NativeBaseProvider>\n  );\n}\n"],"sourceRoot":""}