(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{187:function(e,t,n){"use strict";n.d(t,"a",(function(){return q}));var r=n(0),a=n(256),s=n(257),c=n(2),o=n.n(c),i=n(255),u=n(258),l=n(38),h=n(95),j=n(189),x=n(254),b=n(101),d=n.n(b),f=n(24),p=n.n(f),O=n(25),m=n.n(O),g=n(7),v=n.n(g),w=n(144),y=n(98),k="https://lichess.org",S=function(){var e=new URL(document.location.href);return e.search="",e.href}(),C=function(){function e(){p()(this,e),this.oauth=new w.OAuth2AuthCodePKCE({authorizationUrl:k+"/oauth",tokenUrl:k+"/api/token",clientId:"blindfoldchess.dev",scopes:["challenge:write","bot:play","board:play"],redirectUrl:S,onAccessTokenExpiry:function(e){return e()},onInvalidGrant:function(){}})}return m()(e,[{key:"login",value:function(){return v.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.awrap(this.oauth.fetchAuthorizationCode());case 2:case"end":return e.stop()}}),null,this,null,Promise)}},{key:"init",value:function(){var e,t,n,r,a;return v.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,v.a.awrap(y.a.getItem("@AuthData"));case 2:if(!(e=s.sent)){s.next=5;break}return s.abrupt("return",JSON.parse(e));case 5:return s.next=7,v.a.awrap(this.oauth.isReturningFromAuthServer());case 7:if(!s.sent){s.next=20;break}return s.next=11,v.a.awrap(this.oauth.getAccessToken());case 11:return this.accessContext=s.sent,this.token=null==(t=this.accessContext)||null==(n=t.token)?void 0:n.value,r=this.oauth.decorateFetchHTTPClient(window.fetch),s.next=16,v.a.awrap(this.getUsername(r));case 16:return a={token:this.token,name:this.name},s.next=19,v.a.awrap(y.a.setItem("@AuthData",JSON.stringify(a)));case 19:return s.abrupt("return",a);case 20:return s.abrupt("return",null);case 21:case"end":return s.stop()}}),null,this,null,Promise)}},{key:"getUsername",value:function(e){var t;return v.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,v.a.awrap(e(k+"/api/account"));case 2:return t=n.sent,n.next=5,v.a.awrap(t.json());case 5:this.name=n.sent.username;case 6:case"end":return n.stop()}}),null,this,null,Promise)}},{key:"logout",value:function(){var e,t,n;return v.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return e=null,r.next=3,v.a.awrap(y.a.getItem("@AuthData"));case 3:return(t=r.sent)&&(e=JSON.parse(t)),n=e.token,r.next=8,v.a.awrap(fetch(k+"/api/token",{method:"DELETE",headers:{Authorization:"Bearer "+n}}));case 8:return this.token=void 0,this.accessContext=void 0,this.error=void 0,r.next=13,v.a.awrap(y.a.removeItem("@AuthData"));case 13:case"end":return r.stop()}}),null,this,null,Promise)}}]),e}(),A=n(9),I=Object(r.createContext)({});function z(e){var t=e.children,n=Object(r.useState)(null),a=o()(n,2),s=a[0],c=a[1],i=Object(r.useState)(!1),u=o()(i,2),l=u[0],h=u[1],j=Object(r.useState)(null),x=o()(j,2),b=x[0],d=x[1],f=Object(r.useMemo)((function(){return{user:s,setUser:c,error:b,setError:d,isLoading:l,login:function(){h(!0),(new C).login()},logout:function(){h(!0),(new C).logout().then((function(){c(null)})).finally((function(){h(!1)}))}}}),[s,b,l]);return Object(A.jsx)(I.Provider,{value:f,children:t})}z.propTypes={children:d.a.element.isRequired};var L=n(260),P=n(251),E=n(122),U=n(136),T=n(126),G=n(74),D=n(166),J=n(252);function F(){var e=Object(r.useContext)(I),t=e.login,n=e.isLoading,a=e.error;return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(l.a,{alignItems:"center",justifyContent:"center",flex:1,_dark:{bg:"coolGray.800"},children:Object(A.jsx)(L.a,{onPress:function(){return t()},mt:"2",colorScheme:"tertiary",isLoading:n,children:"Sign in with Lichess.org"})}),a&&Object(A.jsx)(l.a,{position:"absolute",bottom:"0",left:"0",right:"0",py:"3",children:Object(A.jsx)(P.a,{children:Object(A.jsx)(E.a,{space:3,w:"90%",maxW:"400",children:Object(A.jsx)(U.a,{w:"100%",status:"error",variant:"left-accent",children:Object(A.jsx)(T.a,{space:2,flexShrink:1,w:"100%",children:Object(A.jsxs)(h.a,{flexShrink:1,space:2,justifyContent:"space-between",children:[Object(A.jsxs)(h.a,{space:2,flexShrink:1,children:[Object(A.jsx)(U.a.Icon,{mt:"1"}),Object(A.jsx)(G.a,{fontSize:"md",color:"coolGray.800",children:a.toString()})]}),Object(A.jsx)(D.a,{variant:"unstyled",icon:Object(A.jsx)(J.a,{size:"3",color:"coolGray.600"})})]})})})})})})]})}var N=n(261),M=n(238),R=n(259);function _(){var e=Object(r.useContext)(I).logout;return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(N.a,{}),Object(A.jsx)(l.a,{safeAreaTop:!0}),Object(A.jsxs)(h.a,{px:"1",py:"3",justifyContent:"space-between",alignItems:"center",w:"100%",_dark:{bg:"coolGray.800"},children:[Object(A.jsxs)(h.a,{alignItems:"center",children:[Object(A.jsx)(D.a,{icon:Object(A.jsx)(M.a,{size:"sm",as:R.a,name:"menu"})}),Object(A.jsx)(G.a,{fontSize:"20",fontWeight:"bold",children:"Blindfold Chess"})]}),Object(A.jsx)(h.a,{children:Object(A.jsx)(D.a,{onPress:function(){return e()},icon:Object(A.jsx)(M.a,{as:R.a,name:"logout",size:"sm"})})})]})]})}var B=Object(u.a)();function H(){var e=Object(r.useState)(!0),t=o()(e,2),n=t[0],a=t[1],s=Object(r.useContext)(I),c=s.user,u=s.setUser,b=s.setError;return Object(r.useEffect)((function(){a(!0),(new C).init().then((function(e){u(e)})).catch((function(e){b(e)})).finally((function(){a(!1)}))}),[u,b,a]),n?Object(A.jsx)(l.a,{alignItems:"center",justifyContent:"center",flex:1,_dark:{bg:"coolGray.800"},children:Object(A.jsxs)(h.a,{space:2,justifyContent:"center",children:[Object(A.jsx)(j.a,{accessibilityLabel:"Loading"}),Object(A.jsx)(x.a,{color:"primary.500",fontSize:"md",children:"Loading"})]})}):Object(A.jsx)(i.a,{children:Object(A.jsx)(B.Navigator,{children:null==c?Object(A.jsx)(B.Screen,{name:"Sign In",component:F,options:{headerShown:!1}}):Object(A.jsx)(B.Screen,{name:"Home",component:_,options:{headerShown:!1}})})})}var W=Object(a.a)({config:{useSystemColorMode:!0,initialColorMode:"light"}});function q(){return Object(A.jsx)(s.a,{theme:W,children:Object(A.jsx)(z,{children:Object(A.jsx)(H,{})})})}},198:function(e,t,n){e.exports=n(235)}},[[198,1,2]]]);
//# sourceMappingURL=app.04795b1f.chunk.js.map