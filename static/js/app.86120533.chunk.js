(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{189:function(e,t,n){"use strict";n.d(t,"a",(function(){return K}));var r=n(0),a=n(256),s=n(257),c=n(2),o=n.n(c),i=n(255),l=n(258),u=n(33),h=n(95),j=n(190),d=n(251),b=n(102),x=n.n(b),f=n(24),p=n.n(f),O=n(25),m=n.n(O),g=n(8),w=n.n(g),v=n(146),y=n(98),k="https://lichess.org",S=function(){var e=new URL(document.location.href);return e.search="",e.href}(),C=function(){function e(){p()(this,e),this.oauth=new v.OAuth2AuthCodePKCE({authorizationUrl:k+"/oauth",tokenUrl:k+"/api/token",clientId:"blindfoldchess.dev",scopes:["challenge:write","bot:play","board:play"],redirectUrl:S,onAccessTokenExpiry:function(e){return e()},onInvalidGrant:function(){}})}return m()(e,[{key:"login",value:function(){return w.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.awrap(this.oauth.fetchAuthorizationCode());case 2:case"end":return e.stop()}}),null,this,null,Promise)}},{key:"init",value:function(){var e,t,n,r,a;return w.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,w.a.awrap(y.a.getItem("@AuthData"));case 2:if(!(e=s.sent)){s.next=5;break}return s.abrupt("return",JSON.parse(e));case 5:return s.next=7,w.a.awrap(this.oauth.isReturningFromAuthServer());case 7:if(!s.sent){s.next=20;break}return s.next=11,w.a.awrap(this.oauth.getAccessToken());case 11:return this.accessContext=s.sent,this.token=null==(t=this.accessContext)||null==(n=t.token)?void 0:n.value,r=this.oauth.decorateFetchHTTPClient(window.fetch),s.next=16,w.a.awrap(this.getUsername(r));case 16:return a={token:this.token,name:this.name},s.next=19,w.a.awrap(y.a.setItem("@AuthData",JSON.stringify(a)));case 19:return s.abrupt("return",a);case 20:return s.abrupt("return",null);case 21:case"end":return s.stop()}}),null,this,null,Promise)}},{key:"getUsername",value:function(e){var t;return w.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,w.a.awrap(e(k+"/api/account"));case 2:return t=n.sent,n.next=5,w.a.awrap(t.json());case 5:this.name=n.sent.username;case 6:case"end":return n.stop()}}),null,this,null,Promise)}},{key:"logout",value:function(){var e,t,n;return w.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return e=null,r.next=3,w.a.awrap(y.a.getItem("@AuthData"));case 3:return(t=r.sent)&&(e=JSON.parse(t)),n=e.token,r.next=8,w.a.awrap(fetch(k+"/api/token",{method:"DELETE",headers:{Authorization:"Bearer "+n}}));case 8:return this.token=void 0,this.accessContext=void 0,this.error=void 0,r.next=13,w.a.awrap(y.a.removeItem("@AuthData"));case 13:case"end":return r.stop()}}),null,this,null,Promise)}}]),e}(),A=n(7),I=Object(r.createContext)({});function z(e){var t=e.children,n=Object(r.useState)(null),a=o()(n,2),s=a[0],c=a[1],i=Object(r.useState)(!1),l=o()(i,2),u=l[0],h=l[1],j=Object(r.useState)(null),d=o()(j,2),b=d[0],x=d[1],f=Object(r.useMemo)((function(){return{user:s,setUser:c,error:b,setError:x,isLoading:u,login:function(){h(!0),(new C).login()},logout:function(){h(!0),(new C).logout().then((function(){c(null)})).finally((function(){h(!1)}))}}}),[s,b,u]);return Object(A.jsx)(I.Provider,{value:f,children:t})}z.propTypes={children:x.a.element.isRequired};var E=n(55),P=n(260),_=n(261),T=n(252),L=n(124),U=n(137),N=n(128),G=n(168),B=n(253);function D(){var e=Object(r.useContext)(I),t=e.login,n=e.isLoading,a=e.error;return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsxs)(u.a,{alignItems:"center",justifyContent:"center",flex:1,p:"5",_dark:{bg:"light.800"},children:[Object(A.jsx)(d.a,{size:"lg",style:{textTransform:"uppercase"},_dark:{color:"light.300"},children:"Blindfold Chess"}),Object(A.jsxs)(E.a,{mb:"16",_dark:{color:"light.300"},children:["Powered by",Object(A.jsx)(P.a,{href:"lichess.org",ml:"1",children:"lichess.org"})]}),Object(A.jsx)(_.a,{onPress:function(){return t()},mt:"2",w:"100%",maxW:"300",isLoading:n,colorScheme:"amber",children:"SIGN IN"}),Object(A.jsx)(E.a,{mt:"2",fontSize:"xs",_dark:{color:"light.300"},children:"Sign in with your lichess account"})]}),a&&Object(A.jsx)(u.a,{position:"absolute",bottom:"0",left:"0",right:"0",py:"3",children:Object(A.jsx)(T.a,{children:Object(A.jsx)(L.a,{space:3,w:"90%",maxW:"400",children:Object(A.jsx)(U.a,{w:"100%",status:"error",variant:"left-accent",children:Object(A.jsx)(N.a,{space:2,flexShrink:1,w:"100%",children:Object(A.jsxs)(h.a,{flexShrink:1,space:2,justifyContent:"space-between",children:[Object(A.jsxs)(h.a,{space:2,flexShrink:1,children:[Object(A.jsx)(U.a.Icon,{mt:"1"}),Object(A.jsx)(E.a,{fontSize:"md",color:"coolGray.800",children:a.toString()})]}),Object(A.jsx)(G.a,{variant:"unstyled",icon:Object(A.jsx)(B.a,{size:"3",color:"coolGray.600"})})]})})})})})})]})}var J=n(262),W=n(238),F=n(259);function M(){var e=Object(r.useContext)(I).logout;return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(J.a,{}),Object(A.jsx)(u.a,{safeAreaTop:!0}),Object(A.jsxs)(h.a,{px:"1",py:"3",justifyContent:"space-between",alignItems:"center",w:"100%",_dark:{bg:"light.900"},children:[Object(A.jsx)(h.a,{children:Object(A.jsx)(G.a,{icon:Object(A.jsx)(W.a,{size:"sm",as:F.a,name:"menu",_dark:{color:"light.300"}})})}),Object(A.jsx)(h.a,{children:Object(A.jsx)(E.a,{fontSize:"sm",fontWeight:"bold",textTransform:"uppercase",_dark:{color:"light.300"},children:"Blindfold Chess"})}),Object(A.jsx)(h.a,{children:Object(A.jsx)(G.a,{onPress:function(){return e()},icon:Object(A.jsx)(W.a,{as:F.a,name:"logout",size:"sm",_dark:{color:"light.300"}})})})]}),Object(A.jsx)(u.a,{w:"100%",h:"100%",_dark:{bg:"light.800"}}),Object(A.jsx)(u.a,{position:"absolute",bottom:"0",left:"0",right:"0",py:"3",children:Object(A.jsx)(T.a,{children:Object(A.jsx)(L.a,{space:3,w:"90%",maxW:"400",children:Object(A.jsx)(_.a,{colorScheme:"amber",children:"NEW GAME"})})})})]})}var R=Object(l.a)();function H(){var e=Object(r.useState)(!0),t=o()(e,2),n=t[0],a=t[1],s=Object(r.useContext)(I),c=s.user,l=s.setUser,b=s.setError;return Object(r.useEffect)((function(){a(!0),(new C).init().then((function(e){l(e)})).catch((function(e){b(e)})).finally((function(){a(!1)}))}),[l,b,a]),n?Object(A.jsx)(u.a,{alignItems:"center",justifyContent:"center",flex:1,_dark:{bg:"coolGray.800"},children:Object(A.jsxs)(h.a,{space:2,justifyContent:"center",children:[Object(A.jsx)(j.a,{accessibilityLabel:"Loading"}),Object(A.jsx)(d.a,{color:"primary.500",fontSize:"md",children:"Loading"})]})}):Object(A.jsx)(i.a,{children:Object(A.jsx)(R.Navigator,{children:null==c?Object(A.jsx)(R.Screen,{name:"Sign In - Blindfold Chess",component:D,options:{headerShown:!1}}):Object(A.jsx)(R.Screen,{name:"Home - Blindfold Chess",component:M,options:{headerShown:!1}})})})}var q=Object(a.a)({config:{useSystemColorMode:!0,initialColorMode:"light"}});function K(){return Object(A.jsx)(s.a,{theme:q,children:Object(A.jsx)(z,{children:Object(A.jsx)(H,{})})})}},198:function(e,t,n){e.exports=n(235)}},[[198,1,2]]]);
//# sourceMappingURL=app.86120533.chunk.js.map